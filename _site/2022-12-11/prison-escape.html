<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <title>
    
      KringleCon 2022 Prison Escape &middot; Tijjjy Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Tijjjy Blog" />
</head>


  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Tijjjy Blog</h2>
        </a>
        <ul class="nav-social-icons">
          
          
            <li><a target="_blank" href="https://github.com/tijjjy"><i class="fab fa-github"></i></a></li>
          
          
          
        </ul>
      </div>
    </nav>

    <main>
      <div class="post">

  <div class="post-info">
    
      <time datetime="2022-12-11 00:00:00 +0000">December 11, 2022</time>
    
  </div>
  <h1 class="post-title">
    <div>KringleCon 2022 Prison Escape</div>
  </h1>

  <p>Hello, this is my write up of the Prison Escape challenge for kringlecon 2022.</p>

<p>The aim of this challenge is to escape a container aka a container breakout. I must admit I did run down a rabbit hole when doing my first attempt but once I realised the answer it became quite obvious.</p>

<p>Below here we have the starting terminal which you see when starting the challenge.
<img src="/images/kringlecon2022/prisonescape/prisonescape-01.png" alt="Alt text" title="Starting screen" /></p>

<p>Typically the first thing I do when I have a shell whether it be a vm or container is check whether I have sudo privileges, most often than not low privilege users are given more sudo privileges than they actually need, this creates a security risk and path for an attacker to escalate to root.</p>

<p>To check what sudo privileges you have can be done with the following command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo</span> <span class="nt">-l</span></code></pre></figure>

<p>When you run the command you should see this output.
<img src="/images/kringlecon2022/prisonescape/prisonescape-02.png" alt="Alt text" title="sudo -l" /></p>

<p>Taking a look at the output seen above, We can immidiately see our current user can run any command with sudo requiring no password at all!</p>

<p>Now lets escalate to root with the good ole sudo bash and confirm we are root.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>bash
<span class="nb">whoami</span></code></pre></figure>

<p><img src="/images/kringlecon2022/prisonescape/prisonescape-03.png" alt="Alt text" title="sudo bash" /></p>

<p>Upon doing some research into privileged containers I came across an article by trendmicro detailing the –privileged flag for containers and how it can be abused by an attacker to gain access to the host system.<br />
Article: <a href="https://www.trendmicro.com/en_us/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html">why-running-a-privileged-container-in-docker-is-a-bad-idea</a></p>

<p>Further down in the article there is a section explaining that a privileged container has the capability to list as mount the host devices.
<img src="/images/kringlecon2022/prisonescape/prisonescape-04.png" alt="Alt text" title="mounting host devices" /></p>

<p>Lets take a look at prison escape container and see if we can list the host devices in /dev.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">ls</span> /dev</code></pre></figure>

<p><img src="/images/kringlecon2022/prisonescape/prisonescape-05.png" alt="Alt text" title="listing host devices" /></p>

<p>Listing the devices we can see all the standard devices a linux system would have, what caught my eye was the device “vda”, this has the naming standard that I see commonly when creating linux partitions which could be vda, sda, xda from past experience.</p>

<p>Lets go ahead and try to mount the vda device. We can do that with the following commands.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir</span> /mnt/vda
mount /dev/vda /mnt/vda
<span class="nb">cd</span> /mnt/vda</code></pre></figure>

<p><img src="/images/kringlecon2022/prisonescape/prisonescape-06.png" alt="Alt text" title="mounting the vda device" /></p>

<p>It looks like it mounted without errors, now lets see whats in it.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">ls</span></code></pre></figure>

<p><img src="/images/kringlecon2022/prisonescape/prisonescape-07.png" alt="Alt text" title="listed /mnt/vda" /></p>

<p>Wow look at that, we have just mounted the host filesystem. Since this container was started with the “–privileged” flag it has the capability to see and mount the host filesystem as we just did.</p>

<p>Lets go ahead and get the flag which resides in the user “jailer”s’ private key. Now for the purpose of the challenge I’m not going to show the flag so you can atleast go do the challenge yourself and get the experience of breaking out of a container.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cat </span>home/jailer/.ssh/jail.key.priv</code></pre></figure>

<p><img src="/images/kringlecon2022/prisonescape/prisonescape-08.png" alt="Alt text" title="catting the jailers private key" /></p>

<p>Thats it, we successfully completed the prison escape challenge, now go ahead and do it yourself. I personally liked this challenge as I’m quite a fan of containers!</p>


</div>

<div class="relatedPosts">

  
    
    
    
    

    

      
      

      

      

    

      
      

      

      

    

      
      

      

      

    

      
      

      

      

    

    
  

</div>

    </main>

    <footer>
      <span>
        &copy; <time datetime="2023-01-21 12:14:34 +0000">2023</time> Tijjjy. Powered by Jekyll and <a href="#">Rain</a> theme.
      </span>
    </footer>
  </body>
</html>
